version: '3.8'

networks:
  seller-net:
    external: true

volumes:
  seller-ai-qdrant-storage:
    external: true

services:
  seller-ai-rag-agent:
    image: begenfys/seller-ai-rag-agent:latest
    container_name: seller-ai-rag-agent
    ports:
      - "0.0.0.0:${AGENT_HOST_PORT}:${AGENT_PORT}"
    env_file: &env
      - .env.prod
    volumes:
      - ./logs:/app/logs
    restart: &restart unless-stopped
    networks: &networks
      - seller-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  # Опционально: если вы хотите запустить Qdrant локально
#  seller-ai-qdrant:
#    image: qdrant/qdrant:v1.7.4
#    container_name: seller-ai-qdrant
#    ports:
#      - "0.0.0.0:${QDRANT_HOST_PORT}:${QDRANT_PORT}"
#      - "0.0.0.0:${QDRANT_ADMIN_HOST_PORT}:${QDRANT_ADMIN_PORT}"
#    volumes:
#      - seller-ai-qdrant-storage:/qdrant/storage
#    environment:
#      - QDRANT__SERVICE__GRPC_PORT=6334
#    env_file: *env
#    restart: *restart
#    networks: *networks